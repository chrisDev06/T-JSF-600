<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <title>MSN2</title>
    <script src="/socket.io/socket.io.js"></script>
  </head>
  <body>
    <style>
      body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
}

.chat-container {
    display: flex;
    height: 100vh;
}

.sidebar {
    width: 20%;
    background-color: #f0f0f0;
}

.sidebar-header {
    padding: 15px;
    font-weight: bold;
}

.channels {
    padding: 10px;
}

.channel {
    padding: 8px;
    cursor: pointer;
}

.channel.active {
    background-color: #ccc;
}

.conversation {
    flex: 1;
    padding: 20px;
    border-left: 1px solid #ccc;
}

.chat-header {
    font-weight: bold;
    margin-bottom: 20px;
}

.messages {
    max-height: 300px;
    overflow-y: auto;
}

.input-box {
    margin-top: 20px;
    display: flex;
    flex-direction: column;
}

.input-boxInput {
    max-width: 1000px;
    height: 20px;
    margin-top: 20px;
    margin-bottom: 20px;
}

.input-boxButton {
    margin: 10px;
    padding: 8px 15px;
    background-color: #0078D4;
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 10px;
}
    </style>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>


    <p id="p"></p>

    <!-- <form id="form">
      <input type="text" id="chat" >
        <label for="chat"></label> 
      <input type="text" id="user">
        <label for="user"></label>
      <input type="text" id="input">
        <label for="input"></label>
      <input type="submit">
      <button id="button">Disconnect</button>
      <button id="updateButton">Update</button>
      <button id="deleteButton">Delete</button>
    </form> -->

    <form id="formUser">
        <input type="text" id="user" class="input-boxInput">
        <label for="user"></label>
      <input type="submit" class="input-boxButton">
      <button id="button" class="input-boxButton">Disconnect</button>
    </form>

    <div class="container">
      <div class="chat-container">
        <div class="sidebar">
          <div class="sidebar-header">
            Teams
          </div>
          <div class="channels">
            <form id="formChat">
              <input type="text" id="chat" class="input-boxInput">
                <label for="chat"></label> 
              <input type="submit" class="input-boxButton">
              <button id="updateButton" class="input-boxButton">Update</button>
              <button id="deleteButton" class="input-boxButton">Delete</button>
            </form>
          </div>
          <div id="sideScreen"></div>
        </div>
        <div class="conversation">
          <div class="chat-header" id="roomName">
            <p id="fieldName"></p>
          </div>
          <div class="messages">
          </div>
          <div class="input-box">
            <form id="formMessage">
              <input type="text" id="input" class="input-boxInput">
                <label for="input"></label>
              <input type="submit" class="input-boxButton">
              <div id="mainScreen">
                
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
 
    <audio autoplay="false" id="beep" src="../../backend/msn.mp3">
    </audio>

    <script defer>
      const socket = io(); 

      // const welcomeUser = document.getElementById('p');  //affichage user
      // socket.on("newuser", (data) => {
      //     welcomeUser.innerText = data
      //     document.querySelector("body").appendChild(welcomeUser)
      // })

      const formUser = document.getElementById('formUser');
      const formChat = document.getElementById("formChat")
      const formMessage = document.getElementById("formMessage")
      
      const input = document.getElementById('input');
      const chat = document.getElementById('chat');
      const user = document.getElementById('user');

      const updateButton = document.getElementById("updateButton")
      const deleteButton = document.getElementById("deleteButton")

      let roomName = document.getElementById("roomName")
      let fieldName = document.getElementById("fieldName")

     
      formChat.addEventListener('submit', (e) => {
        e.preventDefault();
        if(chat.value != ""){
          socket.emit("selectChat", chat.value)
          chat.value = ""
        }
      })
      formUser.addEventListener('submit', (e) => {
        if(user.value != ""){
          socket.emit("createUser", user.value)
          user.value = "";
        }
      })
      formMessage.addEventListener('submit', (e) => {
        if (input.value != "") {
          tmp2 = input.value.split("")
          if(tmp2[0] == "/"){

            let tmp= input.value.split(" ")

            const commands = {
              "/nick" : "nick",
              "/list" : "list",
              "/create" : "create",
              "/delete" : "delete",
              "/join" : "join",
              "/quit" : "quit",
              "/users" :"users",
              "/msg" : "msg"
            }

          
              for (let key in commands){
                if(tmp[0] === key){
                  socket.emit(key, tmp[1]) 
                }
              }
          }else{
          socket.emit('chatmessage', input.value);
          
          }
          input.value = '';
        }
      }); 

      updateButton.addEventListener("click", ()=> {
            socket.emit("updateChat", chat.value)
            chat.value= ''
          })
      
      deleteButton.addEventListener("click", ()=> {
        socket.emit("deleteChat", chat.value)
        chat.value= ''
      })


      socket.emit('helloServeur', 'connection client -> serveur');  // dialogue serveur-client
      socket.on('helloClient', (arg) => {
      });

      
      socket.on("roomName", (name)=> {
        
          fieldName.innerText= name
          document.querySelector(roomName).appendChild(fieldName)
          
      })
      
      socket.on("message", (data) => {
        let p = document.createElement("p")
        p.innerText = data ;
        document.querySelector("#mainScreen").appendChild(p)
      })
      
      socket.on("allMessages", (data) => {   
        if(data.length>0){
          data.forEach(message => {
            let p = document.createElement("p")
            p.innerText = message.msg ;
            document.querySelector("#mainScreen").appendChild(p)           
          });
        }
      })

      socket.on("listOfRooms", (data) => { 
        if(data.length>0){
          for(let i= 0; i<data.length; i++){
            let p = document.createElement("p")
            p.innerText = data[i]
            document.querySelector("#mainScreen").appendChild(p)
          }
        }
      })

      socket.on("userConnected", (msg)=> {
        let p = document.createElement("p")
            p.innerText = msg
            document.querySelector("#sideScreen").appendChild(p)
      })

      socket.on("userDisconnected", (msg)=> {
        let p = document.createElement("p")
            p.innerText = msg
            document.querySelector("#sideScreen").appendChild(p)
           
      })
      

      const toggleButton = document.getElementById('button');   // button deconnection
      toggleButton.addEventListener('click', (e) => {
        e.preventDefault();
        if (socket.connected) {
          toggleButton.innerText = 'Connect';
          socket.disconnect();
        } else {
          toggleButton.innerText = 'Disconnect';
          socket.connect();
        }
      });
    </script>

  </body>
</html>
